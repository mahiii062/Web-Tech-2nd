<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Bank Setup</title>
    <link rel="stylesheet" href="style.css">
</head>

<body class="page-bg">

    <div class="glass-card" style="width:380px; margin:auto; margin-top:80px;">
        <h2 class="title">Bank Setup</h2>
        <p class="subtitle">Complete your profile to continue</p>

        <div class="input-group">
            <i class="fa fa-id-card icon"></i>
            <input id="acc" type="text" placeholder="Account Number">
        </div>

        <div class="input-group">
            <i class="fa fa-key icon"></i>
            <input id="sec" type="password" placeholder="Secret PIN">
        </div>

        <button onclick="saveBank()" class="login-btn">
            Save & Continue
        </button>

        <p id="msg" style="margin-top:10px; color:#aad4ff;"></p>
    </div>

    <script>
        const user = JSON.parse(localStorage.getItem("user"));
        if (!user) location.href = "/login.html";

        async function saveBank() {
            const accountNumber = document.getElementById("acc").value;
            const secret = document.getElementById("sec").value;

            if (!accountNumber || !secret) {
                document.getElementById("msg").innerText = "All fields required!";
                return;
            }

            const res = await fetch("/api/bank/setup", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    userId: user.id,
                    accountNumber,
                    secret,
                    startingBalance: 2000
                })
            });

            const data = await res.json();

            document.getElementById("msg").innerText = data.message || data.error;

            if (data.message) {
                setTimeout(() => location.href = "/dashboard.html", 1200);
            }
        }
    </script>

</body>

</html>